
<!DOCTYPE html>

<html data-content_root="../" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>On the Fast Fourier Transform to compute the autocovariance â€” pioran</title>
<script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
<!-- Loaded before other Sphinx assets -->
<link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet"/>
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet"/>
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet"/>
<link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet"/>
<link as="font" crossorigin="" href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" rel="preload" type="font/woff2"/>
<link href="../_static/pygments.css?v=a746c00c" rel="stylesheet" type="text/css"/>
<link href="../_static/sphinx-codeautolink.css?v=125d5c1c" rel="stylesheet" type="text/css"/>
<link href="../_static/copybutton.css?v=76b2166b" rel="stylesheet" type="text/css"/>
<link href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" rel="stylesheet" type="text/css"/>
<link href="../_static/graphviz.css?v=eafc0fe6" rel="stylesheet" type="text/css"/>
<link href="../_static/css/custom.css?v=ad57bd55" rel="stylesheet" type="text/css"/>
<!-- Pre-loaded scripts that we'll load fully later -->
<link as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" rel="preload"/>
<link as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" rel="preload"/>
<script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/documentation_options.js?v=5929fcd5"></script>
<script src="../_static/doctools.js?v=888ff710"></script>
<script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
<script src="../_static/clipboard.min.js?v=a7894cd8"></script>
<script src="../_static/copybutton.js?v=f281be69"></script>
<script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
<script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>DOCUMENTATION_OPTIONS.pagename = 'references/On_the_fft';</script>
<link href="../_static/favico.ico" rel="icon"/>
<link href="../genindex.html" rel="index" title="Index"/>
<link href="../search.html" rel="search" title="Search"/>
<link href="On_the_nufft.html" rel="next" title="On the Non-Uniform Fast Fourier Transform to compute the autocovariance"/>
<link href="references.html" rel="prev" title="References"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="en" name="docsearch:language"/>
</head>
<body data-bs-root-margin="0px 0px -60%" data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-default-mode="" data-offset="180">
<a class="skip-link" href="#main-content" id="pst-skip-link">Skip to main content</a>
<div id="pst-scroll-pixel-helper"></div>
<button class="btn rounded-pill" id="pst-back-to-top" type="button">
<i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>
<input class="sidebar-toggle" id="__primary" name="__primary" type="checkbox"/>
<label class="overlay overlay-primary" for="__primary"></label>
<input class="sidebar-toggle" id="__secondary" name="__secondary" type="checkbox"/>
<label class="overlay overlay-secondary" for="__secondary"></label>
<div class="search-button__wrapper">
<div class="search-button__overlay"></div>
<div class="search-button__search-container">
<form action="../search.html" class="bd-search d-flex align-items-center" method="get">
<i class="fa-solid fa-magnifying-glass"></i>
<input aria-label="Search the docs ..." autocapitalize="off" autocomplete="off" autocorrect="off" class="form-control" id="search-input" name="q" placeholder="Search the docs ..." spellcheck="false" type="search"/>
<span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
</div>
<header class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
<label class="sidebar-toggle primary-toggle" for="__primary">
<span class="fa-solid fa-bars"></span>
</label>
<div class="col-lg-3 navbar-header-items__start">
<div class="navbar-item">
<a class="navbar-brand logo" href="../index.html">
<img alt="pioran - Home" class="logo__image only-light" src="../_static/logo_borderbis.png"/>
<script>document.write(`<img src="../_static/logo_borderbis.png" class="logo__image only-dark" alt="pioran - Home"/>`);</script>
</a></div>
</div>
<div class="col-lg-9 navbar-header-items">
<div class="me-auto navbar-header-items__center">
<div class="navbar-item">
<nav class="navbar-nav">
<ul class="bd-navbar-elements navbar-nav">
<li class="nav-item">
<a class="nav-link nav-internal" href="../userguide/User.html">
                        User Guide
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../tutorials/Tutorials.html">
                        Tutorials
                      </a>
</li>
<li class="nav-item current active">
<a class="nav-link nav-internal" href="references.html">
                        References
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../autoapi/index.html">
                        API Reference
                      </a>
</li>
</ul>
</nav></div>
</div>
<div class="navbar-header-items__end">
<div class="navbar-item navbar-persistent--container">
<script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
</div>
<div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
</div>
</div>
<div class="navbar-persistent--mobile">
<script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
</div>
<label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
<span class="fa-solid fa-outdent"></span>
</label>
</div>
</header>
<div class="bd-container">
<div class="bd-container__inner bd-page-width">
<div class="bd-sidebar-primary bd-sidebar">
<div class="sidebar-header-items sidebar-primary__section">
<div class="sidebar-header-items__center">
<div class="navbar-item">
<nav class="navbar-nav">
<ul class="bd-navbar-elements navbar-nav">
<li class="nav-item">
<a class="nav-link nav-internal" href="../userguide/User.html">
                        User Guide
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../tutorials/Tutorials.html">
                        Tutorials
                      </a>
</li>
<li class="nav-item current active">
<a class="nav-link nav-internal" href="references.html">
                        References
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../autoapi/index.html">
                        API Reference
                      </a>
</li>
</ul>
</nav></div>
</div>
<div class="sidebar-header-items__end">
<div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
</div>
</div>
<div class="sidebar-primary-items__start sidebar-primary__section">
<div class="sidebar-primary-item">
<nav aria-label="Section Navigation" class="bd-docs-nav bd-links">
<p aria-level="1" class="bd-links__title" role="heading">Section Navigation</p>
<div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">On the Fast Fourier Transform to compute the autocovariance</a></li>
<li class="toctree-l1"><a class="reference internal" href="On_the_nufft.html">On the Non-Uniform Fast Fourier Transform to compute the autocovariance</a></li>
<li class="toctree-l1"><a class="reference internal" href="On_the_interpolation.html">Interpolation of the discretised autocovariance function</a></li>
<li class="toctree-l1"><a class="reference internal" href="On_the_sample_variance.html">On the sample variance of simulated time series</a></li>
</ul>
</div>
</nav></div>
</div>
<div class="sidebar-primary-items__end sidebar-primary__section">
</div>
<div id="rtd-footer-container"></div>
</div>
<main class="bd-main" id="main-content">
<div class="bd-content">
<div class="bd-article-container">
<div class="bd-header-article">
<div class="header-article-items header-article__inner">
<div class="header-article-items__start">
<div class="header-article-item">
<nav aria-label="Breadcrumb">
<ul class="bd-breadcrumbs">
<li class="breadcrumb-item breadcrumb-home">
<a aria-label="Home" class="nav-link" href="../index.html">
<i class="fa-solid fa-home"></i>
</a>
</li>
<li class="breadcrumb-item"><a class="nav-link" href="references.html">References</a></li>
<li aria-current="page" class="breadcrumb-item active">On the Fast...</li>
</ul>
</nav>
</div>
</div>
</div>
</div>
<div id="searchbox"></div>
<article class="bd-article">
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <a class="sphinx-codeautolink-a" href="https://numpy.org/doc/stable/reference/index.html#module-numpy" title="numpy"><span class="nn">numpy</span></a> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <a class="sphinx-codeautolink-a" href="https://matplotlib.org/stable/api/pyplot_summary.html#module-matplotlib.pyplot" title="matplotlib.pyplot"><span class="nn">matplotlib.pyplot</span></a> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">"https://github.com/mlefkir/beauxgraphs/raw/main/beautifulgraphs_colblind.mplstyle"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="on-the-fast-fourier-transform-to-compute-the-autocovariance">
<h1>On the Fast Fourier Transform to compute the autocovariance<a class="headerlink" href="#on-the-fast-fourier-transform-to-compute-the-autocovariance" title="Link to this heading">#</a></h1>
<p>Here we show the effects of computing the autocovariance function (ACVF) using the Fast Fourier Transform. We will show these effects using functions where we know the analytical Fourier Transform. Which are the exponential and squared exponential autocovariance functions. First we compute the ACVF on an arbitrary grid and then we compute the ACVF on an extended grid of frequencies.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>Autocovariance <span class="math notranslate nohighlight">\(R(\tau)\)</span></p></th>
<th class="head"><p>Power spectrum <span class="math notranslate nohighlight">\(\mathcal{P}(f)\)</span></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Exponential</p></td>
<td><p><span class="math notranslate nohighlight">\(\dfrac{A}{2\gamma} \exp{(-|\tau|\gamma)}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\dfrac{A}{\gamma^2 +4\pi^2 f^2}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>Squared exponential</p></td>
<td><p><span class="math notranslate nohighlight">\(A\exp{(-2 \pi^2 \tau^2 \sigma^2)}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\dfrac{A}{\sqrt{2\pi}\sigma}\)</span> <span class="math notranslate nohighlight">\(\exp\left(-\dfrac{f^2}{2\sigma^2} \right)\)</span></p></td>
</tr>
</tbody>
</table>
<section id="arbitrary-grid-of-frequencies">
<h2>Arbitrary grid of frequencies<a class="headerlink" href="#arbitrary-grid-of-frequencies" title="Link to this heading">#</a></h2>
<section id="squared-exponential-acvf">
<h3>Squared exponential ACVF<a class="headerlink" href="#squared-exponential-acvf" title="Link to this heading">#</a></h3>
<p>First, we define the autocovariance function and its Fourier transform, i.e. the power spectrum.</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">SqExpo_ACV</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>

<span class="k">def</span> <span class="nf">SqExpo_PSD</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">A</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span> <span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">f</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>We generate a grid of frequencies from <span class="math notranslate nohighlight">\(0\)</span> to <span class="math notranslate nohighlight">\(f_N\)</span> with a spacing <span class="math notranslate nohighlight">\(\Delta f=f_0\)</span>. The power spectrum will be of length <span class="math notranslate nohighlight">\(N\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f0</span> <span class="o">=</span> <span class="mf">1e-4</span> <span class="c1"># min frequency </span>
<span class="n">df</span> <span class="o">=</span> <span class="n">f0</span> 
<span class="n">fN</span> <span class="o">=</span> <span class="mf">5.</span> <span class="c1"># max frequency</span>
<span class="c1"># grid of frequencies, from 0 to fend-df with step size df</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">fN</span><span class="p">,</span><span class="n">df</span><span class="p">)</span>
<span class="c1"># number of points in the psd including the zeroth freq</span>
<span class="n">N</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#len" title="len"><span class="nb">len</span></a><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="c1"># define the parameters of the psd</span>
<span class="n">A</span> <span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="mf">1.e-1</span>

<span class="n">P</span> <span class="o">=</span> <span class="n">SqExpo_PSD</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mf">4.5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">P</span><span class="p">,</span><span class="s1">'.'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$f$'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Power spectral density'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Squared exponential"</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/e46cd24d52eb7dc04798198f612b2c8cdcb2e89e264aec244336dd2b41f7e793.png" src="../_images/e46cd24d52eb7dc04798198f612b2c8cdcb2e89e264aec244336dd2b41f7e793.png"/>
</div>
</div>
<p>As we know the power spectrum is symmetric for negative frequencies, we can use the real inverse Fourier transform to compute the autocovariance function.</p>
<p>We use the function <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.fft.irfft.html"><code class="docutils literal notranslate"><span class="pre">np.fft.irfft</span></code></a> to compute the inverse Fourier transform. The discrete inverse Fourier transform returns a real array of length <span class="math notranslate nohighlight">\(2N-2\)</span>. Where <code class="docutils literal notranslate"><span class="pre">x[0]</span></code> is the autocovariance at <span class="math notranslate nohighlight">\(\tau=0\)</span> and <code class="docutils literal notranslate"><span class="pre">x[N-1]</span></code> is the autocovariance at <span class="math notranslate nohighlight">\(\tau=\tau_\mathrm{max}\)</span>, after which the autocovariance is mirrored for negative lags. The time separation between the autocovariance values is given by <span class="math notranslate nohighlight">\(\Delta \tau = \tau_\mathrm{max}/(N-1)\)</span>, where <span class="math notranslate nohighlight">\(\tau_\mathrm{max}=1/2\Delta f\)</span> is the maximum lag for which we compute the autocovariance function.</p>
<p>To obtain the true autocovariance function we divide the result by the sampling frequency <span class="math notranslate nohighlight">\(\Delta f\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmax</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">df</span> 
<span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">df</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">tmax</span><span class="o">+</span><span class="n">dt</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span>

<span class="n">R_theo</span> <span class="o">=</span> <span class="n">SqExpo_ACV</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span> <span class="c1"># theoretical inverse FT of the lorentzian</span>

<span class="c1"># compute the IFFT, with a normalisation factor 1/M, M=2*(len(y)-1)</span>
<span class="n">R_dift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">irfft</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> 
<span class="k">assert</span> <span class="p">(</span><span class="n">R_dift</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">R_dift</span><span class="p">[</span><span class="n">N</span><span class="p">:])</span><span class="o">&lt;</span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#float" title="float"><span class="nb">float</span></a><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="s2">"The IRFFT did not return a mirrored ACV"</span>
<span class="n">R_num</span> <span class="o">=</span> <span class="n">R_dift</span><span class="p">[:</span><span class="n">N</span><span class="p">]</span><span class="o">/</span><span class="n">dt</span>
</pre></div>
</div>
</div>
</div>
<p>Below, we plot the resulting autocovariance function and the error between the numerical and analytical autocovariance function. For plotting purposes, we only plot the autocovariance function for positive lags and up to <span class="math notranslate nohighlight">\(\tau=10\)</span>.</p>
<p>We can see that in the case of the squared exponential autocovariance function, the numerical Fourier transform is exact within the numerical precision.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mf">4.5</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">R_theo</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'Analytical'</span><span class="p">)</span><span class="c1">#,marker='s')</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">t</span><span class="p">,</span> <span class="n">R_num</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'Numerical'</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">'o'</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">1e-5</span><span class="p">,</span><span class="mi">10</span> <span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$\tau$"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"Autocovariance function"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">R_theo</span><span class="o">-</span><span class="n">R_num</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s1">'|Error|'</span><span class="p">)</span><span class="c1">#,marker='s')</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$\tau$"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"Absolute difference"</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">"Inverse Fourier transform of the Squared exponential PSD"</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/abbb2627bef9dead973dc273cfcc8226ad8b28d43de824e019ae521717862be3.png" src="../_images/abbb2627bef9dead973dc273cfcc8226ad8b28d43de824e019ae521717862be3.png"/>
</div>
</div>
<p>We can check the Fourier pairs properties of the autocovariance function and the power spectrum by comparing the sums.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#print" title="print"><span class="nb">print</span></a><span class="p">(</span><span class="sa">f</span><span class="s2">"P(0)           : </span><span class="si">{</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">1.5e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#print" title="print"><span class="nb">print</span></a><span class="p">(</span><span class="sa">f</span><span class="s1">'Sum of ACV     : </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">R_num</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="mi">2</span><span class="si">:</span><span class="s1">1.5e</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
<a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#print" title="print"><span class="nb">print</span></a><span class="p">(</span><span class="sa">f</span><span class="s1">'Sum of ACVtheo : </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">R_theo</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="mi">2</span><span class="si">:</span><span class="s1">1.5e</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
<a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#print" title="print"><span class="nb">print</span></a><span class="p">(</span><span class="sa">f</span><span class="s2">"------Error----: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">R_num</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">dt</span><span class="o">-</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">:</span><span class="s2">1.5e</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#print" title="print"><span class="nb">print</span></a><span class="p">(</span><span class="sa">f</span><span class="s1">'Sum of PSD     : </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">P</span><span class="p">)</span><span class="o">*</span><span class="n">df</span><span class="o">*</span><span class="mi">2</span><span class="si">:</span><span class="s1">1.3e</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
<a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#print" title="print"><span class="nb">print</span></a><span class="p">(</span><span class="sa">f</span><span class="s1">'ACVtheo[0]     : </span><span class="si">{</span><span class="p">(</span><span class="n">R_theo</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">:</span><span class="s1">1.3e</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
<a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#print" title="print"><span class="nb">print</span></a><span class="p">(</span><span class="sa">f</span><span class="s1">'ACV[0]         : </span><span class="si">{</span><span class="n">R_num</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">1.3e</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
<a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#print" title="print"><span class="nb">print</span></a><span class="p">(</span><span class="sa">f</span><span class="s2">"-----Error-----: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">P</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">df</span><span class="o">-</span><span class="n">R_num</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">:</span><span class="s2">1.3e</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>P(0)           : 3.98942e+00
Sum of ACV     : 3.98942e+00
Sum of ACVtheo : 3.98942e+00
------Error----: 1.33227e-15

Sum of PSD     : 1.000e+00
ACVtheo[0]     : 1.000e+00
ACV[0]         : 1.000e+00
-----Error-----: 0.000e+00
</pre></div>
</div>
</div>
</div>
</section>
<section id="exponential-acvf">
<h3>Exponential ACVF<a class="headerlink" href="#exponential-acvf" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Expo_PSD</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">A</span> <span class="o">/</span> <span class="p">(</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">f</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">gamma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
<span class="k">def</span> <span class="nf">Expo_ACV</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span> <span class="n">A</span> <span class="o">/</span> <span class="n">gamma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="o">-</span> <span class="n">gamma</span> <span class="o">*</span> <span class="n">t</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f0</span> <span class="o">=</span> <span class="mf">1e-3</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">f0</span> 
<span class="n">fN</span> <span class="o">=</span> <span class="mf">1.</span> <span class="c1"># max frequency</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">fN</span><span class="p">,</span><span class="n">df</span><span class="p">)</span>
<span class="n">N</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#len" title="len"><span class="nb">len</span></a><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">A</span> <span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="mf">1e-1</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">Expo_PSD</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Unlike in the previous case, the power spectrum is less steep, it does not decay as fast to zero. This means that the autocovariance function at the firs time lags will be more affected by the numerical Fourier transform.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mf">4.5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">P</span><span class="p">,</span><span class="s1">'.'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$f$'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Power spectral density'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Lorentzian PSD"</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/1bc9660c142916632bd2af1feb2916cc1c8664dc714275e8e880b871fc2e94d1.png" src="../_images/1bc9660c142916632bd2af1feb2916cc1c8664dc714275e8e880b871fc2e94d1.png"/>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmax</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">df</span> 
<span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">df</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">tmax</span><span class="o">+</span><span class="n">dt</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span>

<span class="n">R_theo</span> <span class="o">=</span> <span class="n">Expo_ACV</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span>

<span class="c1"># compute the IFFT, with a normalisation factor 1/M, M=2*(len(y)-1)</span>
<span class="n">R_dift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">irfft</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> 
<span class="c1"># assert (R_dift[1:N-1]-np.flip(R_dift[N:])&lt;np.finfo(float).eps).all(), "The IRFFT did not return a mirrored ACV"</span>
<span class="n">R_num</span> <span class="o">=</span> <span class="n">R_dift</span><span class="p">[:</span><span class="n">N</span><span class="p">]</span><span class="o">/</span><span class="n">dt</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>We see that this time FFT does not give an exact result within the numerical precision, this is due to the power spectrum does not decay as fast to zero as in the case of the squared exponential autocovariance function. The Discrete Fourier Transform assumes the signal is periodic, the power spectrum is replicated at the end of the grid of frequencies but because the power spectrum does not decay to zero, the aliasing effect is more important. We will see how to mitigate this effect in the next section.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mf">4.5</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">R_theo</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'Analytical'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">t</span><span class="p">,</span> <span class="n">R_num</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'Numerical'</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">'o'</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">1e-5</span><span class="p">,</span><span class="mi">60</span> <span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$\tau$"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"Autocovariance function"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">R_theo</span><span class="o">-</span><span class="n">R_num</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s1">'|Error|'</span><span class="p">)</span><span class="c1">#,marker='s')</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$\tau$"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Absolute difference"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">1e-5</span><span class="p">,</span><span class="mi">20</span> <span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">"Inverse Fourier transform of the Lorentzian PSD"</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/79f9ffff48df60fc3faecfd2c8f65e494a742d8b558c9f6b0124027ba6e0fba5.png" src="../_images/79f9ffff48df60fc3faecfd2c8f65e494a742d8b558c9f6b0124027ba6e0fba5.png"/>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#print" title="print"><span class="nb">print</span></a><span class="p">(</span><span class="sa">f</span><span class="s2">"P(0)           : </span><span class="si">{</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">1.5e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#print" title="print"><span class="nb">print</span></a><span class="p">(</span><span class="sa">f</span><span class="s1">'Sum of ACV     : </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">R_num</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="mi">2</span><span class="si">:</span><span class="s1">1.5e</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
<a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#print" title="print"><span class="nb">print</span></a><span class="p">(</span><span class="sa">f</span><span class="s1">'Sum of ACVtheo : </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">R_theo</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="mi">2</span><span class="si">:</span><span class="s1">1.5e</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
<a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#print" title="print"><span class="nb">print</span></a><span class="p">(</span><span class="sa">f</span><span class="s2">"------Error----: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">R_num</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">dt</span><span class="o">-</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">:</span><span class="s2">1.5e</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#print" title="print"><span class="nb">print</span></a><span class="p">(</span><span class="sa">f</span><span class="s1">'Sum of PSD     : </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">P</span><span class="p">)</span><span class="o">*</span><span class="n">df</span><span class="o">*</span><span class="mi">2</span><span class="si">:</span><span class="s1">1.3e</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
<a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#print" title="print"><span class="nb">print</span></a><span class="p">(</span><span class="sa">f</span><span class="s1">'ACVtheo[0]     : </span><span class="si">{</span><span class="p">(</span><span class="n">R_theo</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">:</span><span class="s1">1.3e</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
<a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#print" title="print"><span class="nb">print</span></a><span class="p">(</span><span class="sa">f</span><span class="s1">'ACV[0]         : </span><span class="si">{</span><span class="n">R_num</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">1.3e</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
<a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#print" title="print"><span class="nb">print</span></a><span class="p">(</span><span class="sa">f</span><span class="s2">"-----Error-----: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">P</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">df</span><span class="o">-</span><span class="n">R_num</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">:</span><span class="s2">1.3e</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>P(0)           : 1.00000e+02
Sum of ACV     : 1.00000e+02
Sum of ACVtheo : 1.00021e+02
------Error----: 2.84217e-14

Sum of PSD     : 4.949e+00
ACVtheo[0]     : 5.000e+00
ACV[0]         : 4.949e+00
-----Error-----: 0.000e+00
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="extending-the-grid-of-frequencies">
<h2>Extending the grid of frequencies<a class="headerlink" href="#extending-the-grid-of-frequencies" title="Link to this heading">#</a></h2>
<p>As we saw in the previous section, the autocovariance obtained via FFT on a grid of frequencies can be affected by the aliasing effect. To mitigate this effect, we can extend the grid of frequencies.</p>
<p>Let us consider the case of a signal of duration <span class="math notranslate nohighlight">\(T=400\)</span> with a sampling period of <span class="math notranslate nohighlight">\(\Delta T=1\)</span>. We want to compute the ACVF of the signal given our two PSD models. The minimal grid of frequencies to compute the ACVF is <span class="math notranslate nohighlight">\(f_\mathrm{min}=1/T\)</span> and the maximal grid of frequencies is given by the Nyquist frequency <span class="math notranslate nohighlight">\(f_\mathrm{max}=1/2\Delta T\)</span>.
As we saw in the previous section, the autocovariance obtained via FFT on a grid of frequencies can be affected by aliasing.</p>
<p>To mitigate this effect, we extend the grid of frequencies with two factors: <span class="math notranslate nohighlight">\(S_\mathrm{low}\)</span> and <span class="math notranslate nohighlight">\(S_\mathrm{high}\)</span>, for low and high frequencies, respectively. The grid of frequencies is then given by <span class="math notranslate nohighlight">\(f_0 = f_\mathrm{min}/S_\mathrm{low} = \Delta f\)</span> to <span class="math notranslate nohighlight">\(f_N = f_\mathrm{max}S_\mathrm{high}=N \Delta f\)</span>.</p>
<aside class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<span class="docutils literal">[thick]

\draw (0,2pt) -- + (0,-2pt) node[below=1mm] {0};
\draw (.5,2pt) -- + (0,-2pt) node[below=1mm] {$f_0$};
\draw (3.5,5pt) -- + (0,-5pt) node[below=1mm] {$f_\mathrm{min}$};
\draw (10.,5pt) -- + (0,-5pt) node[below=1mm] {$f_\mathrm{max}$};
\draw (14,5pt) -- + (0,-5pt) node[below=1mm] {$f_\mathrm{N}$};
\draw[thick] (0,0) -- node[below=7mm] {Frequency $f$} + (15,0);
\foreach \x in {0,0.5,...,14.}
   \draw (\x cm,3pt) -- (\x cm,-3pt) node[anchor=north] {};</span>)</p>
<p>!pdflatex command cannot be run</p>
</aside>
</section></section></article></div><div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="mi">400</span>
<span class="n">dT</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">f_min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">T</span>
<span class="n">f_max</span> <span class="o">=</span> <span class="mf">.5</span><span class="o">/</span><span class="n">dT</span>
</pre></div>
</div>
</div>
</details>
</div>
<section id="extending-the-high-frequencies">
<h3>Extending the high frequencies<a class="headerlink" href="#extending-the-high-frequencies" title="Link to this heading">#</a></h3>
<p>First, we start by studying the effect of <span class="math notranslate nohighlight">\(S_\mathrm{high}\)</span> on the autocovariance function. We will use the exponential autocovariance function as an example.</p>
<p>To obtain the values of the autocovariance function up to lag <span class="math notranslate nohighlight">\(\tau=T\)</span> (time separation between the first and last value), <span class="math notranslate nohighlight">\(S_\mathrm{low}\)</span> should be larger than <span class="math notranslate nohighlight">\(2\)</span>. This is due to <span class="math notranslate nohighlight">\(\tau_\mathrm{max}=1/2\Delta f\)</span> and <span class="math notranslate nohighlight">\(\Delta f=f_0=\frac{1}{S_\mathrm{low}T}\)</span>.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">S_low</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">S_high</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">f0</span> <span class="o">=</span> <span class="n">f_min</span><span class="o">/</span><span class="n">S_low</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">f0</span>
<span class="n">fN</span> <span class="o">=</span> <span class="n">f_max</span><span class="o">*</span><span class="n">S_high</span> <span class="c1"># max frequency</span>
<span class="c1"># grid of frequencies, from 0 to fend-df with step size df</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">fN</span><span class="p">,</span><span class="n">f0</span><span class="p">)</span>
<span class="c1"># number of points in the psd including the zeroth freq</span>
<span class="n">N</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#len" title="len"><span class="nb">len</span></a><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="c1"># define the parameters of the psd</span>
<span class="n">A</span> <span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="mf">1e-1</span>

<span class="n">P</span> <span class="o">=</span> <span class="n">Expo_PSD</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mf">4.5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">P</span><span class="p">,</span><span class="s1">'.'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$f$'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Power spectral density'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Extended frequency grid with $S_\mathrm</span><span class="si">{low}</span><span class="s2">=</span><span class="si">%i</span><span class="s2">$ and $S_\mathrm</span><span class="si">{high}</span><span class="s2">=</span><span class="si">%i</span><span class="s2">$"</span><span class="o">%</span><span class="p">(</span><span class="n">S_low</span><span class="p">,</span><span class="n">S_high</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">f_min</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">'--'</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'C1'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'$f_\mathrm</span><span class="si">{min}</span><span class="s1">$'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">f_max</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">'-.'</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'C3'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'$f_\mathrm</span><span class="si">{max}</span><span class="s1">$'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;&gt;:21: SyntaxWarning: invalid escape sequence '\m'
&lt;&gt;:21: SyntaxWarning: invalid escape sequence '\m'
/tmp/ipykernel_1722/717671293.py:21: SyntaxWarning: invalid escape sequence '\m'
  ax.set_title("Extended frequency grid with $S_\mathrm{low}=%i$ and $S_\mathrm{high}=%i$"%(S_low,S_high))
</pre></div>
</div>
<img alt="../_images/7f4b4226866e6463e8a45efddd93324d5acbe3df98cddaeaffb86278bf4e82a0.png" src="../_images/7f4b4226866e6463e8a45efddd93324d5acbe3df98cddaeaffb86278bf4e82a0.png"/>
</div>
</div>
<p>For several values of <span class="math notranslate nohighlight">\(S_\mathrm{high}\)</span>, we compute the autocovariance function and the error between the numerical and analytical autocovariance function. We plot the absolute difference up to <span class="math notranslate nohighlight">\(\tau_\mathrm{max}\)</span> with an inset for lags up to <span class="math notranslate nohighlight">\(\tau=10\)</span>.</p>
<p>The error at the first lags and all other lags is decreasing as <span class="math notranslate nohighlight">\(S_\mathrm{high}\)</span> increases, this reduces aliasing, the power spectrum at high frequencies is slowly reaching zero as more frequencies are added. Also the error appears to attain a plateau for high values of <span class="math notranslate nohighlight">\(\tau\)</span>, a plateau which is always smaller for higher values of <span class="math notranslate nohighlight">\(S_\mathrm{high}\)</span>.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mf">7.5</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">S_high</span> <span class="ow">in</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#enumerate" title="enumerate"><span class="nb">enumerate</span></a><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">]):</span>

    <span class="n">f0</span> <span class="o">=</span> <span class="n">f_min</span><span class="o">/</span><span class="n">S_low</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">f0</span>
    <span class="n">fN</span> <span class="o">=</span> <span class="n">f_max</span><span class="o">*</span><span class="n">S_high</span> <span class="c1"># max frequency</span>
    <span class="c1"># grid of frequencies, from 0 to fend-df with step size df</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">fN</span><span class="p">,</span><span class="n">f0</span><span class="p">)</span>
    <span class="c1"># number of points in the psd including the zeroth freq</span>
    <span class="n">N</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#len" title="len"><span class="nb">len</span></a><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="c1"># define the parameters of the psd</span>
    <span class="n">A</span> <span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="mf">1e-1</span>

    <span class="n">P</span> <span class="o">=</span> <span class="n">Expo_PSD</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">N</span><span class="o">%</span><span class="k">2</span>==0:
        <span class="n">N</span><span class="o">+=</span><span class="mi">1</span>
    <span class="n">tmax</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">df</span> 
    <span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">df</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">tmax</span><span class="o">+</span><span class="n">dt</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span>

    <span class="n">R_theo</span> <span class="o">=</span> <span class="n">Expo_ACV</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span>

    <span class="c1"># compute the IFFT, with a normalisation factor 1/M, M=2*(len(y)-1)</span>
    <span class="n">R_dift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">irfft</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> 
    <span class="c1"># assert (R_dift[1:N-1]-np.flip(R_dift[N:])&lt;np.finfo(float).eps).all(), "The IRFFT did not return a mirrored ACV"</span>
    <span class="n">R_num</span> <span class="o">=</span> <span class="n">R_dift</span><span class="p">[:</span><span class="n">N</span><span class="p">]</span><span class="o">/</span><span class="n">dt</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">R_theo</span><span class="o">-</span><span class="n">R_num</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">'$S_\mathrm</span><span class="se">{{</span><span class="s1">high</span><span class="se">}}</span><span class="s1">=</span><span class="se">{{</span><span class="si">{</span><span class="n">S_high</span><span class="si">}</span><span class="se">}}</span><span class="s1">$'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span><span class="c1">#,marker='s')</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$\tau$"</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"Absolute difference"</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">1e-14</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="p">:</span> 
        <span class="n">axins</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">inset_axes</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])</span>
    <span class="n">axins</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">R_theo</span><span class="o">-</span><span class="n">R_num</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">'$S_\mathrm</span><span class="se">{{</span><span class="s1">high</span><span class="se">}}</span><span class="s1">=</span><span class="se">{{</span><span class="si">{</span><span class="n">S_high</span><span class="si">}</span><span class="se">}}</span><span class="s1">$'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span><span class="c1">#,marker='s')</span>
    <span class="c1"># subregion of the original image</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="mf">.5e-1</span>
    <span class="n">axins</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
    <span class="n">axins</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
    <span class="n">axins</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>

        
    <span class="n">ax</span><span class="o">.</span><span class="n">indicate_inset_zoom</span><span class="p">(</span><span class="n">axins</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">"grey"</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.06</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">"lower center"</span><span class="p">,</span>
                <span class="n">bbox_transform</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">transFigure</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">"Absolute difference between analytical and numerical ACVF"</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;&gt;:30: SyntaxWarning: invalid escape sequence '\m'
&lt;&gt;:38: SyntaxWarning: invalid escape sequence '\m'
&lt;&gt;:30: SyntaxWarning: invalid escape sequence '\m'
&lt;&gt;:38: SyntaxWarning: invalid escape sequence '\m'
/tmp/ipykernel_1722/3567205907.py:30: SyntaxWarning: invalid escape sequence '\m'
  ax.plot(t,np.abs(R_theo-R_num),label=f'$S_\mathrm{{high}}={{{S_high}}}$',alpha=0.8)#,marker='s')
/tmp/ipykernel_1722/3567205907.py:38: SyntaxWarning: invalid escape sequence '\m'
  axins.plot(t,np.abs(R_theo-R_num),label=f'$S_\mathrm{{high}}={{{S_high}}}$',alpha=0.8)#,marker='s')
</pre></div>
</div>
<img alt="../_images/c80cba88eba7f2368643da734c9db37ee5ee22a7d1285b7133b991debf5efd67.png" src="../_images/c80cba88eba7f2368643da734c9db37ee5ee22a7d1285b7133b991debf5efd67.png"/>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">S_low</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">S_high</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">f0</span> <span class="o">=</span> <span class="n">f_min</span><span class="o">/</span><span class="n">S_low</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">f0</span>
<span class="n">fN</span> <span class="o">=</span> <span class="n">f_max</span><span class="o">*</span><span class="n">S_high</span> <span class="c1"># max frequency</span>
<span class="c1"># grid of frequencies, from 0 to fend-df with step size df</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">fN</span><span class="p">,</span><span class="n">f0</span><span class="p">)</span>
<span class="c1"># number of points in the psd including the zeroth freq</span>
<span class="n">N</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#len" title="len"><span class="nb">len</span></a><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="c1"># define the parameters of the psd</span>
<span class="n">A</span> <span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="mf">1e-1</span>

<span class="n">P</span> <span class="o">=</span> <span class="n">Expo_PSD</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">12.5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">'width_ratios'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]})</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">P</span><span class="p">,</span><span class="s1">'.'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$f$'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Power spectral density'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">()</span>
<span class="c1"># ax[0].set_title("PSD with $S_\mathrm{low}=%i$ and $S_\mathrm{high}=%i$"%(S_low,S_high))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Power spectrum"</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">f_min</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">'--'</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'C1'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'$f_\mathrm</span><span class="si">{min}</span><span class="s1">$ (with $S_\mathrm</span><span class="si">{low}</span><span class="s1">=</span><span class="si">%i</span><span class="s1">$)'</span><span class="o">%</span><span class="k">S_low</span>)
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">f_max</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">'-.'</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'C3'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'$f_\mathrm</span><span class="si">{max}</span><span class="s1">$ (with $S_\mathrm</span><span class="si">{high}</span><span class="s1">=</span><span class="si">%i</span><span class="s1">$)'</span><span class="o">%</span><span class="k">S_high</span>)
<span class="c1"># ax[0].legend(loc='lower left')</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.22</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.09</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">"lower center"</span><span class="p">,</span>
                <span class="n">bbox_transform</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">transFigure</span><span class="p">)</span>
<span class="c1"># fig.tight_layout()</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">S_high</span> <span class="ow">in</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#enumerate" title="enumerate"><span class="nb">enumerate</span></a><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">]):</span>

    <span class="n">f0</span> <span class="o">=</span> <span class="n">f_min</span><span class="o">/</span><span class="n">S_low</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">f0</span>
    <span class="n">fN</span> <span class="o">=</span> <span class="n">f_max</span><span class="o">*</span><span class="n">S_high</span> <span class="c1"># max frequency</span>
    <span class="c1"># grid of frequencies, from 0 to fend-df with step size df</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">fN</span><span class="p">,</span><span class="n">f0</span><span class="p">)</span>
    <span class="c1"># number of points in the psd including the zeroth freq</span>
    <span class="n">N</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#len" title="len"><span class="nb">len</span></a><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="c1"># define the parameters of the psd</span>
    <span class="n">A</span> <span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="mf">1e-1</span>

    <span class="n">P</span> <span class="o">=</span> <span class="n">Expo_PSD</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">N</span><span class="o">%</span><span class="k">2</span>==0:
        <span class="n">N</span><span class="o">+=</span><span class="mi">1</span>
    <span class="n">tmax</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">df</span> 
    <span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">df</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">tmax</span><span class="o">+</span><span class="n">dt</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span>

    <span class="n">R_theo</span> <span class="o">=</span> <span class="n">Expo_ACV</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span>

    <span class="c1"># compute the IFFT, with a normalisation factor 1/M, M=2*(len(y)-1)</span>
    <span class="n">R_dift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">irfft</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> 
    <span class="c1"># assert (R_dift[1:N-1]-np.flip(R_dift[N:])&lt;np.finfo(float).eps).all(), "The IRFFT did not return a mirrored ACV"</span>
    <span class="n">R_num</span> <span class="o">=</span> <span class="n">R_dift</span><span class="p">[:</span><span class="n">N</span><span class="p">]</span><span class="o">/</span><span class="n">dt</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">R_theo</span><span class="o">-</span><span class="n">R_num</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">'$S_\mathrm</span><span class="se">{{</span><span class="s1">high</span><span class="se">}}</span><span class="s1">=</span><span class="se">{{</span><span class="si">{</span><span class="n">S_high</span><span class="si">}</span><span class="se">}}</span><span class="s1">$'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span><span class="c1">#,marker='s')</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$\tau$"</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"Absolute difference"</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">1e-14</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="p">:</span> 
        <span class="n">axins</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">inset_axes</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])</span>
    <span class="n">axins</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">R_theo</span><span class="o">-</span><span class="n">R_num</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">'$S_\mathrm</span><span class="se">{{</span><span class="s1">high</span><span class="se">}}</span><span class="s1">=</span><span class="se">{{</span><span class="si">{</span><span class="n">S_high</span><span class="si">}</span><span class="se">}}</span><span class="s1">$'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span><span class="c1">#,marker='s')</span>
    <span class="c1"># subregion of the original image</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="mf">.5e-1</span>
    <span class="n">axins</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
    <span class="n">axins</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
    <span class="n">axins</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>

        
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">indicate_inset_zoom</span><span class="p">(</span><span class="n">axins</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">"grey"</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.09</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">"lower center"</span><span class="p">,</span>
                <span class="n">bbox_transform</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">transFigure</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Absolute difference between analytical and numerical ACVF"</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">'FFT_ACVF_expo.pdf'</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">'tight'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;&gt;:56: SyntaxWarning: invalid escape sequence '\m'
&lt;&gt;:64: SyntaxWarning: invalid escape sequence '\m'
&lt;&gt;:56: SyntaxWarning: invalid escape sequence '\m'
&lt;&gt;:64: SyntaxWarning: invalid escape sequence '\m'
/tmp/ipykernel_1722/2648465469.py:56: SyntaxWarning: invalid escape sequence '\m'
  ax[1].plot(t,np.abs(R_theo-R_num),label=f'$S_\mathrm{{high}}={{{S_high}}}$',alpha=0.8)#,marker='s')
/tmp/ipykernel_1722/2648465469.py:64: SyntaxWarning: invalid escape sequence '\m'
  axins.plot(t,np.abs(R_theo-R_num),label=f'$S_\mathrm{{high}}={{{S_high}}}$',alpha=0.8)#,marker='s')
</pre></div>
</div>
<img alt="../_images/e340403e3c4a2f73b2f92bea01fe4dd582539b438817ecb1bc41de622b536c24.png" src="../_images/e340403e3c4a2f73b2f92bea01fe4dd582539b438817ecb1bc41de622b536c24.png"/>
</div>
</details>
</div>
</section>
<section id="extending-the-low-frequencies">
<h3>Extending the low frequencies<a class="headerlink" href="#extending-the-low-frequencies" title="Link to this heading">#</a></h3>
<p>This time, we study the effect of <span class="math notranslate nohighlight">\(S_\mathrm{low}\)</span> on the autocovariance function. We keep <span class="math notranslate nohighlight">\(S_\mathrm{high}=1\)</span> and we vary <span class="math notranslate nohighlight">\(S_\mathrm{low}\)</span>.</p>
<p>Below, we plot the power spectrum on the extended grid of frequencies, more frequencies are added at low frequencies, as <span class="math notranslate nohighlight">\(f_0\)</span> decreases with <span class="math notranslate nohighlight">\(S_\mathrm{low}\)</span> the sampling in frequency is very dense.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">S_low</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">S_high</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">f0</span> <span class="o">=</span> <span class="n">f_min</span><span class="o">/</span><span class="n">S_low</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">f0</span>
<span class="n">fN</span> <span class="o">=</span> <span class="n">f_max</span><span class="o">*</span><span class="n">S_high</span> <span class="c1"># max frequency</span>
<span class="c1"># grid of frequencies, from 0 to fend-df with step size df</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">fN</span><span class="p">,</span><span class="n">f0</span><span class="p">)</span>
<span class="c1"># number of points in the psd including the zeroth freq</span>
<span class="n">N</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#len" title="len"><span class="nb">len</span></a><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="c1"># define the parameters of the psd</span>
<span class="n">A</span> <span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="mf">1e-1</span>

<span class="n">P</span> <span class="o">=</span> <span class="n">Expo_PSD</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mf">4.5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">P</span><span class="p">,</span><span class="s1">'.'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$f$'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Power spectral density'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Extended frequency grid with $S_\mathrm</span><span class="si">{low}</span><span class="s2">=</span><span class="si">%i</span><span class="s2">$ and $S_\mathrm</span><span class="si">{high}</span><span class="s2">=</span><span class="si">%i</span><span class="s2">$"</span><span class="o">%</span><span class="p">(</span><span class="n">S_low</span><span class="p">,</span><span class="n">S_high</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">f_min</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">'--'</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'C1'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'$f_\mathrm</span><span class="si">{min}</span><span class="s1">$'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">f_max</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">'-.'</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'C3'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'$f_\mathrm</span><span class="si">{max}</span><span class="s1">$'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;&gt;:21: SyntaxWarning: invalid escape sequence '\m'
&lt;&gt;:21: SyntaxWarning: invalid escape sequence '\m'
/tmp/ipykernel_1722/1677276729.py:21: SyntaxWarning: invalid escape sequence '\m'
  ax.set_title("Extended frequency grid with $S_\mathrm{low}=%i$ and $S_\mathrm{high}=%i$"%(S_low,S_high))
</pre></div>
</div>
<img alt="../_images/3e2f69ff9b008b22b81a4d047284d1aee43fd4981e1c50b4f4061e0428590bb6.png" src="../_images/3e2f69ff9b008b22b81a4d047284d1aee43fd4981e1c50b4f4061e0428590bb6.png"/>
</div>
</div>
<p>As <span class="math notranslate nohighlight">\(S_\mathrm{low}\)</span> increases, the error for the first lags decreases very slowly. The error appears to attain a plateau for high values of <span class="math notranslate nohighlight">\(\tau\)</span>, a plateau which is always the same for all values of <span class="math notranslate nohighlight">\(S_\mathrm{low}\)</span> except for <span class="math notranslate nohighlight">\(S_\mathrm{low}=2\)</span>.  Comparing with the previous figure, we can clearly see that the effect of <span class="math notranslate nohighlight">\(S_\mathrm{high}\)</span> is more important than the effect of <span class="math notranslate nohighlight">\(S_\mathrm{low}\)</span>.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mf">5.5</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">S_low</span> <span class="ow">in</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#enumerate" title="enumerate"><span class="nb">enumerate</span></a><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">]):</span>

    <span class="n">f0</span> <span class="o">=</span> <span class="n">f_min</span><span class="o">/</span><span class="n">S_low</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">f0</span>
    <span class="n">fN</span> <span class="o">=</span> <span class="n">f_max</span><span class="o">*</span><span class="n">S_high</span> <span class="c1"># max frequency</span>
    <span class="c1"># grid of frequencies, from 0 to fend-df with step size df</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">fN</span><span class="p">,</span><span class="n">f0</span><span class="p">)</span>
    <span class="c1"># number of points in the psd including the zeroth freq</span>
    <span class="n">N</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#len" title="len"><span class="nb">len</span></a><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="c1"># define the parameters of the psd</span>
    <span class="n">A</span> <span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="mf">1e-1</span>

    <span class="n">P</span> <span class="o">=</span> <span class="n">Expo_PSD</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">N</span><span class="o">%</span><span class="k">2</span>==0:
        <span class="n">N</span><span class="o">+=</span><span class="mi">1</span>
    <span class="n">tmax</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">df</span> 
    <span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">df</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">tmax</span><span class="o">+</span><span class="n">dt</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span>

    <span class="n">R_theo</span> <span class="o">=</span> <span class="n">Expo_ACV</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span>

    <span class="c1"># compute the IFFT, with a normalisation factor 1/M, M=2*(len(y)-1)</span>
    <span class="n">R_dift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">irfft</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> 
    <span class="c1"># assert (R_dift[1:N-1]-np.flip(R_dift[N:])&lt;np.finfo(float).eps).all(), "The IRFFT did not return a mirrored ACV"</span>
    <span class="n">R_num</span> <span class="o">=</span> <span class="n">R_dift</span><span class="p">[:</span><span class="n">N</span><span class="p">]</span><span class="o">/</span><span class="n">dt</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">R_theo</span><span class="o">-</span><span class="n">R_num</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">'$S_\mathrm</span><span class="se">{{</span><span class="s1">low</span><span class="se">}}</span><span class="s1">=</span><span class="se">{{</span><span class="si">{</span><span class="n">S_low</span><span class="si">}</span><span class="se">}}</span><span class="s1">$'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span><span class="c1">#,marker='s')</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$\tau$"</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"Absolute difference"</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">1e-7</span><span class="p">,</span><span class="mf">.5</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="p">:</span> 
        <span class="n">axins</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">inset_axes</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
    <span class="n">axins</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">R_theo</span><span class="o">-</span><span class="n">R_num</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">'$S_\mathrm</span><span class="se">{{</span><span class="s1">low</span><span class="se">}}</span><span class="s1">=</span><span class="se">{{</span><span class="si">{</span><span class="n">S_low</span><span class="si">}</span><span class="se">}}</span><span class="s1">$'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span><span class="c1">#,marker='s')</span>
    <span class="c1"># subregion of the original image</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="mf">.5</span>
    <span class="n">axins</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
    <span class="n">axins</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
    <span class="n">axins</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">indicate_inset_zoom</span><span class="p">(</span><span class="n">axins</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">"grey"</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.06</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">"lower center"</span><span class="p">,</span>
                <span class="n">bbox_transform</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">transFigure</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">"Absolute difference between analytical and numerical ACVF"</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;&gt;:30: SyntaxWarning: invalid escape sequence '\m'
&lt;&gt;:39: SyntaxWarning: invalid escape sequence '\m'
&lt;&gt;:30: SyntaxWarning: invalid escape sequence '\m'
&lt;&gt;:39: SyntaxWarning: invalid escape sequence '\m'
/tmp/ipykernel_1722/2695329910.py:30: SyntaxWarning: invalid escape sequence '\m'
  ax.plot(t,np.abs(R_theo-R_num),label=f'$S_\mathrm{{low}}={{{S_low}}}$',alpha=0.8)#,marker='s')
/tmp/ipykernel_1722/2695329910.py:39: SyntaxWarning: invalid escape sequence '\m'
  axins.plot(t,np.abs(R_theo-R_num),label=f'$S_\mathrm{{low}}={{{S_low}}}$',alpha=0.8)#,marker='s')
</pre></div>
</div>
<img alt="../_images/6149cfab022b940cb86b88dc2a382ac52256f67602cfd654ddeb8597d5a8266b.png" src="../_images/6149cfab022b940cb86b88dc2a382ac52256f67602cfd654ddeb8597d5a8266b.png"/>
</div>
</div>
</section>

<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Link to this heading">#</a></h2>
<p>In practice, we should use both <span class="math notranslate nohighlight">\(S_\mathrm{low}\)</span> and <span class="math notranslate nohighlight">\(S_\mathrm{high}\)</span> to extend the grid of frequencies. The optimal values of <span class="math notranslate nohighlight">\(S_\mathrm{low}\)</span> and <span class="math notranslate nohighlight">\(S_\mathrm{high}\)</span> depend on the power spectrum but also on the desired time lags, it might be necessary to try several values of <span class="math notranslate nohighlight">\(S_\mathrm{low}\)</span> and <span class="math notranslate nohighlight">\(S_\mathrm{high}\)</span> to check that the computation of the autocovariance function gives a good estimate of the true autocovariance function.</p>
</section>


<footer class="prev-next-footer">
<div class="prev-next-area">
<a class="left-prev" href="references.html" title="previous page">
<i class="fa-solid fa-angle-left"></i>
<div class="prev-next-info">
<p class="prev-next-subtitle">previous</p>
<p class="prev-next-title">References</p>
</div>
</a>
<a class="right-next" href="On_the_nufft.html" title="next page">
<div class="prev-next-info">
<p class="prev-next-subtitle">next</p>
<p class="prev-next-title">On the Non-Uniform Fast Fourier Transform to compute the autocovariance</p>
</div>
<i class="fa-solid fa-angle-right"></i>
</a>
</div>
</footer>
</div>
<div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">
<div class="sidebar-secondary-item">
<div class="page-toc tocsection onthispage" id="pst-page-navigation-heading-2">
<i class="fa-solid fa-list"></i> On this page
  </div>
<nav aria-labelledby="pst-page-navigation-heading-2" class="bd-toc-nav page-toc">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#arbitrary-grid-of-frequencies">Arbitrary grid of frequencies</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#squared-exponential-acvf">Squared exponential ACVF</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exponential-acvf">Exponential ACVF</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extending-the-grid-of-frequencies">Extending the grid of frequencies</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extending-the-high-frequencies">Extending the high frequencies</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extending-the-low-frequencies">Extending the low frequencies</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
</ul>
</nav></div>
<div class="sidebar-secondary-item">
<div class="tocsection sourcelink">
<a href="../_sources/references/On_the_fft.ipynb.txt">
<i class="fa-solid fa-file-lines"></i> Show Source
    </a>
</div>
</div>
</div></div>
</main></div>
<footer class="bd-footer-content">
</footer>

</div>

<!-- Scripts loaded after <body> so the DOM is not blocked -->
<script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>
<footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
<div class="footer-items__start">
<div class="footer-item">
<p class="copyright">
    
      Â© Copyright 2023, Mehdy Lefkir.
      <br/>
</p>
</div>
<div class="footer-item">
<p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    <br/>
</p>
</div>
</div>
<div class="footer-items__end">
<div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.2.
</p></div>
</div>
</div>
</footer>
</body>
</html>